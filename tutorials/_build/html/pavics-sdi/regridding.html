

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Regridding climate data with xESMF &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'pavics-sdi/regridding';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Gridded Data Renderer" href="rendering.html" />
    <link rel="prev" title="Accessing PAVICS THREDDS Server" href="pavics_thredds.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../workflow/hummingbird.html">Hummingbird</a></li>
<li class="toctree-l1"><a class="reference internal" href="climex.html">Analyzing the ClimEx Large Ensemble</a></li>


<li class="toctree-l1"><a class="reference internal" href="eccc-geoapi-climate-stations.html">Working with the ECCC GeoAPI to access weather station data</a></li>
<li class="toctree-l1"><a class="reference internal" href="eccc-geoapi-xclim.html">Compute climate indicators on weather station data from ECCC’s API</a></li>
<li class="toctree-l1"><a class="reference internal" href="esgf-dap.html">Earth System Grid Federation Data Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="forecasts.html">Computing indices on weather forecasts</a></li>
<li class="toctree-l1"><a class="reference internal" href="jupyter_extensions.html">JupyterLab Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="opendap.html">Data Access Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="pavics_thredds.html">Accessing PAVICS THREDDS Server</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Regridding climate data with xESMF</a></li>
<li class="toctree-l1"><a class="reference internal" href="rendering.html">Gridded Data Renderer</a></li>
<li class="toctree-l1"><a class="reference internal" href="subset-user-input.html">General workflow demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="subsetting.html">Spatial and temporal subsetting</a></li>
<li class="toctree-l1"><a class="reference internal" href="weaver_example.html">PAVICS Web Processing Services using OGC-API integration with Weaver</a></li>
<li class="toctree-l1"><a class="reference internal" href="WCS_example.html">Web Coverage Service - Accessing GeoMet data using owslib</a></li>
<li class="toctree-l1"><a class="reference internal" href="WFS_example.html">Web Feature Service - Accessing region countours saved on a GeoServer</a></li>
<li class="toctree-l1"><a class="reference internal" href="WMS_example.html">Working with owslib’s WMS interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="WPS_example.html">PAVICS Web Processing Services</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fpavics-sdi/regridding.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/pavics-sdi/regridding.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Regridding climate data with xESMF</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-example-bilinear-regridding-from-model-to-obs">Simple example : Bilinear regridding from model to obs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-input-data">The input data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-output-grid">The output grid</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regridding-input-data-unto-the-output-grid">Regridding input data unto the output grid</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#second-example-conservative-regridding-and-reusing-weights">Second example : Conservative regridding and reusing weights</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#untangling-corners-definitions">Untangling corners definitions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-the-corners">Computing the corners</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regridding">Regridding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reusing-weights">Reusing weights</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#third-example-regridding-and-masks">Third example : Regridding and masks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#target-grid-and-mask">Target grid and mask</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#default-regridding-no-mask-handling">Default regridding - No mask handling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#normalization-for-conservative-regridding">Normalization for conservative regridding</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fourth-example-averaging-over-polygons">Fourth example : Averaging over polygons</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-polygon-shapes">Define polygon shapes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validate-and-simplify-shapes">Validate and simplify shapes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#averaging-over-each-polygon">Averaging over each polygon</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-polygon-features-properties-into-the-result">Merging polygon features’ properties into the result</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="regridding-climate-data-with-xesmf">
<h1>Regridding climate data with xESMF<a class="headerlink" href="#regridding-climate-data-with-xesmf" title="Permalink to this heading">#</a></h1>
<p>A common element of climate data workflows is regridding, or reprojection, of model data unto more standard grids, or simply unto another dataset’s grid. The powerful <a class="reference external" href="http://earthsystemmodeling.org/docs/release/ESMF_8_0_1/ESMF_usrdoc/">ESMF</a> program, written in FORTRAN, has long been a reference in the matter. The <a class="reference external" href="https://pangeo-xesmf.readthedocs.io/en/latest/">xESMF</a> python package provides an easy to use high-level API for using ESMF’s methods. This notebook shows some examples of common regridding operations.</p>
<p>Regridding with <code class="docutils literal notranslate"><span class="pre">xESMF</span></code> is usually a two step process:</p>
<ol class="arabic simple">
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">Regridder</span></code> objects from two datasets, defining the input and the output grids. This compute a weights mask which can, if needed, be saved to a netCDCF file.</p></li>
<li><p>Regrid a DataArray or Dataset by calling the <code class="docutils literal notranslate"><span class="pre">Regridder</span></code> with it. As the weights have already been computed, it reuses them for all time slices, which allows much better performance than, for example, interpolation using <code class="docutils literal notranslate"><span class="pre">scipy.interpolation.interpn</span></code>.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>  <span class="c1"># isort: skip</span>
<span class="kn">from</span> <span class="nn">owslib.wfs</span> <span class="kn">import</span> <span class="n">WebFeatureService</span>  <span class="c1"># isort: skip</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># ipykernel_launcher.py:1: DeprecationWarning: xclim.subset is deprecated in xclim v0.19.1-beta. Please take note that xclim presently exposes the &#39;clisops&#39; library subsetting API via `from clisops.core import subset`.</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>

<span class="c1"># Other utilities for style and clean examples</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">import</span> <span class="nn">cf_xarray</span> <span class="k">as</span> <span class="nn">cfxr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">shapely</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">xesmf</span> <span class="k">as</span> <span class="nn">xe</span>
<span class="kn">from</span> <span class="nn">clisops.core.subset</span> <span class="kn">import</span> <span class="n">subset_bbox</span>  <span class="c1"># For subsetting</span>
<span class="kn">from</span> <span class="nn">xclim.testing</span> <span class="kn">import</span> <span class="n">open_dataset</span>  <span class="c1"># For opening xclim&#39;s test data</span>

<span class="c1">#  A colormap with grey where the data is missing</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">))</span>
<span class="n">cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># NBVAL_IGNORE_OUTPUT</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>  <span class="c1"># isort: skip</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">from</span> <span class="nn">owslib.wfs</span> <span class="kn">import</span> <span class="n">WebFeatureService</span>  <span class="c1"># isort: skip</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">import</span> <span class="nn">warnings</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;geopandas&#39;
</pre></div>
</div>
</div>
</div>
<section id="simple-example-bilinear-regridding-from-model-to-obs">
<h2>Simple example : Bilinear regridding from model to obs<a class="headerlink" href="#simple-example-bilinear-regridding-from-model-to-obs" title="Permalink to this heading">#</a></h2>
<p>Our input in this example is a year of monthly sea ice concentration data from a CanESM5 run for CMIP6. It lies on an irregular grid defined by <code class="docutils literal notranslate"><span class="pre">latitude</span></code> and <code class="docutils literal notranslate"><span class="pre">longitude</span></code> coordinates. We’ll interpolate the sea ice concentration to a regular observational grid from Natural Resources Canada.</p>
<section id="the-input-data">
<h3>The input data<a class="headerlink" href="#the-input-data" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>

<span class="c1"># The input test data is hosted on the Ouranos THREDDS</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://pavics.ouranos.ca/twitcher/ows/proxy/thredds/dodsC/birdhouse/testdata/xclim/cmip6/sic_SImon_CCCma-CanESM5_ssp245_r13i1p2f1_2020.nc&quot;</span>
<span class="n">ds_in</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">ds_in</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:             (time: 12, bnds: 2, j: 291, i: 360, vertices: 4)
Coordinates:
  * time                (time) object 2020-01-16 12:00:00 ... 2020-12-16 12:0...
  * j                   (j) int32 0 1 2 3 4 5 6 ... 284 285 286 287 288 289 290
  * i                   (i) int32 0 1 2 3 4 5 6 ... 353 354 355 356 357 358 359
    type                |S64 b&#x27;sea_ice&#x27;
    latitude            (j, i) float64 ...
    longitude           (j, i) float64 ...
Dimensions without coordinates: bnds, vertices
Data variables:
    time_bnds           (time, bnds) object 2020-01-01 00:00:00 ... 2021-01-0...
    vertices_latitude   (j, i, vertices) float64 ...
    vertices_longitude  (j, i, vertices) float64 ...
    siconc              (time, j, i) float32 ...
    areacello           (j, i) float32 ...
Attributes: (12/56)
    CCCma_model_hash:                fc4bb7db954c862d023b546e19aec6c588bc0552
    CCCma_parent_runid:              p2-his13
    CCCma_pycmor_hash:               26c970628162d607fffd14254956ebc6dd3b6f49
    CCCma_runid:                     p2-s4513
    Conventions:                     CF-1.7 CMIP-6.2
    YMDH_branch_time_in_child:       2015:01:01:00
    ...                              ...
    license:                         CMIP6 model data produced by The Governm...
    cmor_version:                    3.5.0
    tracking_id:                     hdl:21.14100/9e4f804b-c161-44fa-acd1-c2e...
    DODS.strlen:                     64
    DODS.dimName:                    maxStrlen64
    DODS_EXTRA.Unlimited_Dimension:  time</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-79837abc-a698-4c24-9207-d708a2c8ab90' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-79837abc-a698-4c24-9207-d708a2c8ab90' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 12</li><li><span>bnds</span>: 2</li><li><span class='xr-has-index'>j</span>: 291</li><li><span class='xr-has-index'>i</span>: 360</li><li><span>vertices</span>: 4</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-9b3d02a8-fc59-4db7-b571-5e8fd495cfb5' class='xr-section-summary-in' type='checkbox'  checked><label for='section-9b3d02a8-fc59-4db7-b571-5e8fd495cfb5' class='xr-section-summary' >Coordinates: <span>(6)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>2020-01-16 12:00:00 ... 2020-12-...</div><input id='attrs-24fd12f5-01ea-403b-8312-fb75779c7c59' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-24fd12f5-01ea-403b-8312-fb75779c7c59' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7a03f1f5-1a22-4c41-9212-64b72de97b26' class='xr-var-data-in' type='checkbox'><label for='data-7a03f1f5-1a22-4c41-9212-64b72de97b26' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>bounds :</span></dt><dd>time_bnds</dd><dt><span>axis :</span></dt><dd>T</dd><dt><span>long_name :</span></dt><dd>time</dd><dt><span>standard_name :</span></dt><dd>time</dd><dt><span>_ChunkSizes :</span></dt><dd>512</dd></dl></div><div class='xr-var-data'><pre>array([cftime.DatetimeNoLeap(2020, 1, 16, 12, 0, 0, 0, has_year_zero=True),
       cftime.DatetimeNoLeap(2020, 2, 15, 0, 0, 0, 0, has_year_zero=True),
       cftime.DatetimeNoLeap(2020, 3, 16, 12, 0, 0, 0, has_year_zero=True),
       cftime.DatetimeNoLeap(2020, 4, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.DatetimeNoLeap(2020, 5, 16, 12, 0, 0, 0, has_year_zero=True),
       cftime.DatetimeNoLeap(2020, 6, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.DatetimeNoLeap(2020, 7, 16, 12, 0, 0, 0, has_year_zero=True),
       cftime.DatetimeNoLeap(2020, 8, 16, 12, 0, 0, 0, has_year_zero=True),
       cftime.DatetimeNoLeap(2020, 9, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.DatetimeNoLeap(2020, 10, 16, 12, 0, 0, 0, has_year_zero=True),
       cftime.DatetimeNoLeap(2020, 11, 16, 0, 0, 0, 0, has_year_zero=True),
       cftime.DatetimeNoLeap(2020, 12, 16, 12, 0, 0, 0, has_year_zero=True)],
      dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>j</span></div><div class='xr-var-dims'>(j)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 ... 286 287 288 289 290</div><input id='attrs-d098d500-74d5-454b-9252-164cb10983e1' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d098d500-74d5-454b-9252-164cb10983e1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f74883fd-c162-4393-9076-f1bcbdf88f8d' class='xr-var-data-in' type='checkbox'><label for='data-f74883fd-c162-4393-9076-f1bcbdf88f8d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>1</dd><dt><span>long_name :</span></dt><dd>cell index along second dimension</dd></dl></div><div class='xr-var-data'><pre>array([  0,   1,   2, ..., 288, 289, 290], dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>i</span></div><div class='xr-var-dims'>(i)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 ... 355 356 357 358 359</div><input id='attrs-cf20bed9-4ebc-46c3-917d-9a58da3f602a' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-cf20bed9-4ebc-46c3-917d-9a58da3f602a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-09934773-63eb-4186-bb65-4ac46de6c3e7' class='xr-var-data-in' type='checkbox'><label for='data-09934773-63eb-4186-bb65-4ac46de6c3e7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>1</dd><dt><span>long_name :</span></dt><dd>cell index along first dimension</dd></dl></div><div class='xr-var-data'><pre>array([  0,   1,   2, ..., 357, 358, 359], dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>type</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>|S64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-d57fd75e-d935-4d47-893e-dffa030aec95' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d57fd75e-d935-4d47-893e-dffa030aec95' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c3c436cf-8fdf-4416-9db5-2f0ebdf97b36' class='xr-var-data-in' type='checkbox'><label for='data-c3c436cf-8fdf-4416-9db5-2f0ebdf97b36' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Sea Ice area type</dd><dt><span>standard_name :</span></dt><dd>area_type</dd></dl></div><div class='xr-var-data'><pre>array(b&#x27;sea_ice&#x27;, dtype=&#x27;|S64&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>latitude</span></div><div class='xr-var-dims'>(j, i)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-def4b3bd-64a1-4d3b-91ba-748d536bda64' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-def4b3bd-64a1-4d3b-91ba-748d536bda64' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d8c26fb2-cc88-42b2-83b2-8adc3ba44205' class='xr-var-data-in' type='checkbox'><label for='data-d8c26fb2-cc88-42b2-83b2-8adc3ba44205' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>bounds :</span></dt><dd>vertices_latitude</dd><dt><span>_ChunkSizes :</span></dt><dd>[291 360]</dd></dl></div><div class='xr-var-data'><pre>[104760 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>longitude</span></div><div class='xr-var-dims'>(j, i)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-f35c37d6-4b41-4ac3-a12c-95356e993563' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f35c37d6-4b41-4ac3-a12c-95356e993563' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dc4ffb14-a86a-4ef2-8b69-73f4cf3c46a4' class='xr-var-data-in' type='checkbox'><label for='data-dc4ffb14-a86a-4ef2-8b69-73f4cf3c46a4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd><dt><span>bounds :</span></dt><dd>vertices_longitude</dd><dt><span>_ChunkSizes :</span></dt><dd>[291 360]</dd></dl></div><div class='xr-var-data'><pre>[104760 values with dtype=float64]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-0a935810-036d-4414-b760-dcf45ea762d7' class='xr-section-summary-in' type='checkbox'  checked><label for='section-0a935810-036d-4414-b760-dcf45ea762d7' class='xr-section-summary' >Data variables: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>time_bnds</span></div><div class='xr-var-dims'>(time, bnds)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-45baa00c-b651-4659-92c0-c014a8532abc' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-45baa00c-b651-4659-92c0-c014a8532abc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a8b91963-4e37-4af0-a46e-41d7f18fdf78' class='xr-var-data-in' type='checkbox'><label for='data-a8b91963-4e37-4af0-a46e-41d7f18fdf78' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>_ChunkSizes :</span></dt><dd>[1 2]</dd></dl></div><div class='xr-var-data'><pre>array([[cftime.DatetimeNoLeap(2020, 1, 1, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(2020, 2, 1, 0, 0, 0, 0, has_year_zero=True)],
       [cftime.DatetimeNoLeap(2020, 2, 1, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(2020, 3, 1, 0, 0, 0, 0, has_year_zero=True)],
       [cftime.DatetimeNoLeap(2020, 3, 1, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(2020, 4, 1, 0, 0, 0, 0, has_year_zero=True)],
       [cftime.DatetimeNoLeap(2020, 4, 1, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(2020, 5, 1, 0, 0, 0, 0, has_year_zero=True)],
       [cftime.DatetimeNoLeap(2020, 5, 1, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(2020, 6, 1, 0, 0, 0, 0, has_year_zero=True)],
       [cftime.DatetimeNoLeap(2020, 6, 1, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(2020, 7, 1, 0, 0, 0, 0, has_year_zero=True)],
       [cftime.DatetimeNoLeap(2020, 7, 1, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(2020, 8, 1, 0, 0, 0, 0, has_year_zero=True)],
       [cftime.DatetimeNoLeap(2020, 8, 1, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(2020, 9, 1, 0, 0, 0, 0, has_year_zero=True)],
       [cftime.DatetimeNoLeap(2020, 9, 1, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(2020, 10, 1, 0, 0, 0, 0, has_year_zero=True)],
       [cftime.DatetimeNoLeap(2020, 10, 1, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(2020, 11, 1, 0, 0, 0, 0, has_year_zero=True)],
       [cftime.DatetimeNoLeap(2020, 11, 1, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(2020, 12, 1, 0, 0, 0, 0, has_year_zero=True)],
       [cftime.DatetimeNoLeap(2020, 12, 1, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(2021, 1, 1, 0, 0, 0, 0, has_year_zero=True)]],
      dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>vertices_latitude</span></div><div class='xr-var-dims'>(j, i, vertices)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-91317023-2d02-42a3-bb9e-67fc2cb8e86b' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-91317023-2d02-42a3-bb9e-67fc2cb8e86b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ea91b1d5-76b3-4d92-ba91-74fd6887f256' class='xr-var-data-in' type='checkbox'><label for='data-ea91b1d5-76b3-4d92-ba91-74fd6887f256' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>_ChunkSizes :</span></dt><dd>[291 360   4]</dd></dl></div><div class='xr-var-data'><pre>[419040 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>vertices_longitude</span></div><div class='xr-var-dims'>(j, i, vertices)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-6e369831-34dc-43df-b4aa-0cc84088d856' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-6e369831-34dc-43df-b4aa-0cc84088d856' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a3116059-1f87-40b4-9963-aa99ac753ec0' class='xr-var-data-in' type='checkbox'><label for='data-a3116059-1f87-40b4-9963-aa99ac753ec0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>_ChunkSizes :</span></dt><dd>[291 360   4]</dd></dl></div><div class='xr-var-data'><pre>[419040 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>siconc</span></div><div class='xr-var-dims'>(time, j, i)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-d1b359b1-93bc-4797-8012-9eac95926e55' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d1b359b1-93bc-4797-8012-9eac95926e55' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-effcdb88-67ce-4500-bcf8-9d082425204a' class='xr-var-data-in' type='checkbox'><label for='data-effcdb88-67ce-4500-bcf8-9d082425204a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>sea_ice_area_fraction</dd><dt><span>long_name :</span></dt><dd>Sea-Ice Area Percentage (Ocean Grid)</dd><dt><span>comment :</span></dt><dd>Percentage of grid cell covered by sea ice</dd><dt><span>units :</span></dt><dd>%</dd><dt><span>original_name :</span></dt><dd>soicecov</dd><dt><span>history :</span></dt><dd>mltby100_ocn 2019-09-25T23:01:33Z altered by CMOR: Treated scalar dimension: &#x27;type&#x27;.</dd><dt><span>cell_methods :</span></dt><dd>area: mean where sea time: mean</dd><dt><span>cell_measures :</span></dt><dd>area: areacello</dd><dt><span>_ChunkSizes :</span></dt><dd>[  1 291 360]</dd></dl></div><div class='xr-var-data'><pre>[1257120 values with dtype=float32]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>areacello</span></div><div class='xr-var-dims'>(j, i)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-fff10df8-11bd-4aac-8a59-f8e7ab0a7167' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-fff10df8-11bd-4aac-8a59-f8e7ab0a7167' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8abbfde9-3ce1-4a87-af45-7adf227875de' class='xr-var-data-in' type='checkbox'><label for='data-8abbfde9-3ce1-4a87-af45-7adf227875de' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>cell_area</dd><dt><span>long_name :</span></dt><dd>Grid-Cell Area for Ocean Variables</dd><dt><span>comment :</span></dt><dd>Horizontal area of ocean grid cells</dd><dt><span>units :</span></dt><dd>m2</dd><dt><span>original_name :</span></dt><dd>areacello</dd><dt><span>cell_methods :</span></dt><dd>area: sum</dd><dt><span>_ChunkSizes :</span></dt><dd>[291 360]</dd></dl></div><div class='xr-var-data'><pre>[104760 values with dtype=float32]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-f354144e-2ad6-4e03-9f74-4a6c6a650d8e' class='xr-section-summary-in' type='checkbox'  ><label for='section-f354144e-2ad6-4e03-9f74-4a6c6a650d8e' class='xr-section-summary' >Attributes: <span>(56)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>CCCma_model_hash :</span></dt><dd>fc4bb7db954c862d023b546e19aec6c588bc0552</dd><dt><span>CCCma_parent_runid :</span></dt><dd>p2-his13</dd><dt><span>CCCma_pycmor_hash :</span></dt><dd>26c970628162d607fffd14254956ebc6dd3b6f49</dd><dt><span>CCCma_runid :</span></dt><dd>p2-s4513</dd><dt><span>Conventions :</span></dt><dd>CF-1.7 CMIP-6.2</dd><dt><span>YMDH_branch_time_in_child :</span></dt><dd>2015:01:01:00</dd><dt><span>YMDH_branch_time_in_parent :</span></dt><dd>2015:01:01:00</dd><dt><span>activity_id :</span></dt><dd>ScenarioMIP</dd><dt><span>branch_method :</span></dt><dd>Spin-up documentation</dd><dt><span>branch_time_in_child :</span></dt><dd>60225.0</dd><dt><span>branch_time_in_parent :</span></dt><dd>60225.0</dd><dt><span>contact :</span></dt><dd>ec.cccma.info-info.ccmac.ec@canada.ca</dd><dt><span>creation_date :</span></dt><dd>2019-09-25T23:01:33Z</dd><dt><span>data_specs_version :</span></dt><dd>01.00.30</dd><dt><span>experiment :</span></dt><dd>update of RCP4.5 based on SSP2</dd><dt><span>experiment_id :</span></dt><dd>ssp245</dd><dt><span>external_variables :</span></dt><dd>areacello</dd><dt><span>forcing_index :</span></dt><dd>1</dd><dt><span>frequency :</span></dt><dd>mon</dd><dt><span>further_info_url :</span></dt><dd>https://furtherinfo.es-doc.org/CMIP6.CCCma.CanESM5.ssp245.none.r13i1p2f1</dd><dt><span>grid :</span></dt><dd>ORCA1 tripolar grid, 1 deg with refinement to 1/3 deg within 20 degrees of the equator; 361 x 290 longitude/latitude; 45 vertical levels; top grid cell 0-6.19 m</dd><dt><span>grid_label :</span></dt><dd>gn</dd><dt><span>history :</span></dt><dd>2019-09-25T23:01:33Z ;rewrote data to be consistent with ScenarioMIP for variable siconc found in table SImon.</dd><dt><span>initialization_index :</span></dt><dd>1</dd><dt><span>institution :</span></dt><dd>Canadian Centre for Climate Modelling and Analysis, Environment and Climate Change Canada, Victoria, BC V8P 5C2, Canada</dd><dt><span>institution_id :</span></dt><dd>CCCma</dd><dt><span>mip_era :</span></dt><dd>CMIP6</dd><dt><span>nominal_resolution :</span></dt><dd>100 km</dd><dt><span>parent_activity_id :</span></dt><dd>CMIP</dd><dt><span>parent_experiment_id :</span></dt><dd>historical</dd><dt><span>parent_mip_era :</span></dt><dd>CMIP6</dd><dt><span>parent_source_id :</span></dt><dd>CanESM5</dd><dt><span>parent_time_units :</span></dt><dd>days since 1850-01-01 0:0:0.0</dd><dt><span>parent_variant_label :</span></dt><dd>r13i1p2f1</dd><dt><span>physics_index :</span></dt><dd>2</dd><dt><span>product :</span></dt><dd>model-output</dd><dt><span>realization_index :</span></dt><dd>13</dd><dt><span>realm :</span></dt><dd>seaIce</dd><dt><span>references :</span></dt><dd>Geophysical Model Development Special issue on CanESM5 (https://www.geosci-model-dev.net/special_issue989.html)</dd><dt><span>source :</span></dt><dd>CanESM5 (2019): 
aerosol: interactive
atmos: CanAM5 (T63L49 native atmosphere, T63 Linear Gaussian Grid; 128 x 64 longitude/latitude; 49 levels; top level 1 hPa)
atmosChem: specified oxidants for aerosols
land: CLASS3.6/CTEM1.2
landIce: specified ice sheets
ocean: NEMO3.4.1 (ORCA1 tripolar grid, 1 deg with refinement to 1/3 deg within 20 degrees of the equator; 361 x 290 longitude/latitude; 45 vertical levels; top grid cell 0-6.19 m)
ocnBgchem: Canadian Model of Ocean Carbon (CMOC); NPZD ecosystem with OMIP prescribed carbonate chemistry
seaIce: LIM2</dd><dt><span>source_id :</span></dt><dd>CanESM5</dd><dt><span>source_type :</span></dt><dd>AOGCM</dd><dt><span>sub_experiment :</span></dt><dd>none</dd><dt><span>sub_experiment_id :</span></dt><dd>none</dd><dt><span>table_id :</span></dt><dd>SImon</dd><dt><span>table_info :</span></dt><dd>Creation Date:(09 May 2019) MD5:38ea1fbdf3f31659e83c719fb4c48428</dd><dt><span>title :</span></dt><dd>CanESM5 output prepared for CMIP6</dd><dt><span>variable_id :</span></dt><dd>siconc</dd><dt><span>variant_label :</span></dt><dd>r13i1p2f1</dd><dt><span>version :</span></dt><dd>v20190429</dd><dt><span>license :</span></dt><dd>CMIP6 model data produced by The Government of Canada (Canadian Centre for Climate Modelling and Analysis, Environment and Climate Change Canada) is licensed under a Creative Commons Attribution ShareAlike 4.0 International License (https://creativecommons.org/licenses). Consult https://pcmdi.llnl.gov/CMIP6/TermsOfUse for terms of use governing CMIP6 output, including citation requirements and proper acknowledgment. Further information about this data, including some limitations, can be found via the further_info_url (recorded as a global attribute in this file) and at https:///pcmdi.llnl.gov/. The data producers and data providers make no warranty, either express or implied, including, but not limited to, warranties of merchantability and fitness for a particular purpose. All liabilities arising from the supply of the information (including any liability arising in negligence) are excluded to the fullest extent permitted by law.</dd><dt><span>cmor_version :</span></dt><dd>3.5.0</dd><dt><span>tracking_id :</span></dt><dd>hdl:21.14100/9e4f804b-c161-44fa-acd1-c2e94e220c95</dd><dt><span>DODS.strlen :</span></dt><dd>64</dd><dt><span>DODS.dimName :</span></dt><dd>maxStrlen64</dd><dt><span>DODS_EXTRA.Unlimited_Dimension :</span></dt><dd>time</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s look at the grid shape itself and the data for one time step</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ds_in</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ds_in</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;The input horizontal grid points as seen on a lat/lon map.</span><span class="se">\n</span><span class="s2">Only the northern hemisphere is shown.&quot;</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;latitude [</span><span class="si">{</span><span class="n">ds_in</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">units</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;longitude [</span><span class="si">{</span><span class="n">ds_in</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">units</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<span class="n">ds_in</span><span class="o">.</span><span class="n">siconc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Sea Ice concentration on Jan 2020, original grid&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4b57e1d580e5cdd170b09ad91ae0c4ba7c6df8e949051b3255eae16535d4afc3.png" src="../_images/4b57e1d580e5cdd170b09ad91ae0c4ba7c6df8e949051b3255eae16535d4afc3.png" />
</div>
</div>
</section>
<section id="the-output-grid">
<h3>The output grid<a class="headerlink" href="#the-output-grid" title="Permalink to this heading">#</a></h3>
<p>The NRCAN observations’ dataset uses a simple rectangular lat/lon grid over Canada at about 10km resolution. To reduce computation time for this example, we’ll first crop the grid to include only Hudson Bay and the Labrador Sea.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>

<span class="n">url_obs</span> <span class="o">=</span> <span class="s2">&quot;https://pavics.ouranos.ca/twitcher/ows/proxy/thredds/dodsC/datasets/gridded_obs/nrcan_v2.ncml&quot;</span>

<span class="c1"># For this example, we&#39;re not interested in the observation data, only its underlying grid, so we&#39;ll select a single time step.</span>
<span class="n">ds_obs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">url_obs</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s2">&quot;1993-05-20&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

<span class="c1"># Subset over the Hudson Bay and the Labrador Sea for the example</span>
<span class="n">bbox</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lon_bnds</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">99.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">41.92</span><span class="p">],</span> <span class="n">lat_bnds</span><span class="o">=</span><span class="p">[</span><span class="mf">50.35</span><span class="p">,</span> <span class="mf">67.61</span><span class="p">])</span>
<span class="n">ds_tgt</span> <span class="o">=</span> <span class="n">subset_bbox</span><span class="p">(</span><span class="n">ds_obs</span><span class="p">,</span> <span class="o">**</span><span class="n">bbox</span><span class="p">)</span>
<span class="n">ds_tgt</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  (lat: 207, lon: 570)
Coordinates:
  * lat      (lat) float32 67.54 67.46 67.38 67.29 ... 50.62 50.54 50.46 50.38
  * lon      (lon) float32 -99.46 -99.38 -99.29 -99.21 ... -52.21 -52.13 -52.04
Data variables:
    tasmin   (lat, lon) float32 ...
    tasmax   (lat, lon) float32 ...
    pr       (lat, lon) float32 ...
Attributes: (12/15)
    Conventions:          CF-1.5
    title:                NRCAN ANUSPLIN daily gridded dataset : version 2
    history:              Fri Jan 25 14:11:15 2019 : Convert from original fo...
    institute_id:         NRCAN
    frequency:            day
    abstract:             Gridded daily observational dataset produced by Nat...
    ...                   ...
    dataset_id:           NRCAN_anusplin_daily_v2
    version:              2.0
    license_type:         permissive
    license:              https://open.canada.ca/en/open-government-licence-c...
    attribution:          The authors provide this data under the Environment...
    citation:             Natural Resources Canada ANUSPLIN interpolated hist...</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-594eec81-8d46-4362-8399-e1938a82cf73' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-594eec81-8d46-4362-8399-e1938a82cf73' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>lat</span>: 207</li><li><span class='xr-has-index'>lon</span>: 570</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-dae80135-c341-49d8-b73d-383b23b8bc16' class='xr-section-summary-in' type='checkbox'  checked><label for='section-dae80135-c341-49d8-b73d-383b23b8bc16' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>67.54 67.46 67.38 ... 50.46 50.38</div><input id='attrs-eff16894-d18b-484e-b2a5-fda2f0363b11' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-eff16894-d18b-484e-b2a5-fda2f0363b11' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c10a06f6-ae00-4501-b8ce-bfdb748d323f' class='xr-var-data-in' type='checkbox'><label for='data-c10a06f6-ae00-4501-b8ce-bfdb748d323f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>Y</dd><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>_ChunkSizes :</span></dt><dd>510</dd></dl></div><div class='xr-var-data'><pre>array([67.541664, 67.458336, 67.375   , ..., 50.541668, 50.458332, 50.375   ],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-99.46 -99.38 ... -52.13 -52.04</div><input id='attrs-a94c7c92-22c9-4c1c-aa30-75cc35710562' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a94c7c92-22c9-4c1c-aa30-75cc35710562' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8663b723-ca39-479f-b9ee-15debb1c6ded' class='xr-var-data-in' type='checkbox'><label for='data-8663b723-ca39-479f-b9ee-15debb1c6ded' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>X</dd><dt><span>units :</span></dt><dd>degrees_east</dd><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>_ChunkSizes :</span></dt><dd>1068</dd></dl></div><div class='xr-var-data'><pre>array([-99.458336, -99.375   , -99.29167 , ..., -52.208336, -52.125004,
       -52.04167 ], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-e29e38d3-58ca-4c37-b099-500d708b05fb' class='xr-section-summary-in' type='checkbox'  checked><label for='section-e29e38d3-58ca-4c37-b099-500d708b05fb' class='xr-section-summary' >Data variables: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>tasmin</span></div><div class='xr-var-dims'>(lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-b794e9d1-516e-47bc-abaa-184f07f09b7f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-b794e9d1-516e-47bc-abaa-184f07f09b7f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c795063c-611f-4fc3-9232-067310f2ad98' class='xr-var-data-in' type='checkbox'><label for='data-c795063c-611f-4fc3-9232-067310f2ad98' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>K</dd><dt><span>long_name :</span></dt><dd>air_temperature</dd><dt><span>standard_name :</span></dt><dd>air_temperature</dd><dt><span>_ChunkSizes :</span></dt><dd>[366  50  50]</dd></dl></div><div class='xr-var-data'><pre>[117990 values with dtype=float32]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tasmax</span></div><div class='xr-var-dims'>(lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-f1f62695-6bc0-41ac-8d31-58277333f5cc' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f1f62695-6bc0-41ac-8d31-58277333f5cc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5d406df6-f6e6-41da-8c90-c5445082b13c' class='xr-var-data-in' type='checkbox'><label for='data-5d406df6-f6e6-41da-8c90-c5445082b13c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>K</dd><dt><span>long_name :</span></dt><dd>air_temperature</dd><dt><span>standard_name :</span></dt><dd>air_temperature</dd><dt><span>_ChunkSizes :</span></dt><dd>[366  50  50]</dd></dl></div><div class='xr-var-data'><pre>[117990 values with dtype=float32]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>pr</span></div><div class='xr-var-dims'>(lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-98e9f737-ccd4-4335-b853-cab5fa73963e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-98e9f737-ccd4-4335-b853-cab5fa73963e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d61e04ac-4201-416a-a349-72e103e25145' class='xr-var-data-in' type='checkbox'><label for='data-d61e04ac-4201-416a-a349-72e103e25145' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>mm s-1</dd><dt><span>long_name :</span></dt><dd>lwe_precipitation_rate</dd><dt><span>standard_name :</span></dt><dd>lwe_precipitation_rate</dd><dt><span>_ChunkSizes :</span></dt><dd>[366  50  50]</dd></dl></div><div class='xr-var-data'><pre>[117990 values with dtype=float32]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-5ed9d5f4-18bf-4cb0-8867-475d68c776c3' class='xr-section-summary-in' type='checkbox'  ><label for='section-5ed9d5f4-18bf-4cb0-8867-475d68c776c3' class='xr-section-summary' >Attributes: <span>(15)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>CF-1.5</dd><dt><span>title :</span></dt><dd>NRCAN ANUSPLIN daily gridded dataset : version 2</dd><dt><span>history :</span></dt><dd>Fri Jan 25 14:11:15 2019 : Convert from original format to NetCDF</dd><dt><span>institute_id :</span></dt><dd>NRCAN</dd><dt><span>frequency :</span></dt><dd>day</dd><dt><span>abstract :</span></dt><dd>Gridded daily observational dataset produced by Natural Resources Canada (NRCan), available at 300 arc second spatial resolution (1/12° grids, ~10 km) over Canada. The version 2 dataset was updated in its entirety compared with version 1 and is not a simple extension of version 1 with additional years of data. Gridding was accomplished with the Australian National University Spline (ANUSPLIN) implementation of the trivariate thin plate splines interpolation method with latitude, longitude and elevation as predictors. </dd><dt><span>dataset_description :</span></dt><dd>https://cfs.nrcan.gc.ca/projects/3/1</dd><dt><span>type :</span></dt><dd>gridded_obs</dd><dt><span>institute :</span></dt><dd>Natural Resources Canada : Canadian Forest Service</dd><dt><span>dataset_id :</span></dt><dd>NRCAN_anusplin_daily_v2</dd><dt><span>version :</span></dt><dd>2.0</dd><dt><span>license_type :</span></dt><dd>permissive</dd><dt><span>license :</span></dt><dd>https://open.canada.ca/en/open-government-licence-canada</dd><dt><span>attribution :</span></dt><dd>The authors provide this data under the Environment and Climate Change Canada Data Server End Use License and demand that any references to or derivative works based on this dataset be cited using the provided citation information</dd><dt><span>citation :</span></dt><dd>Natural Resources Canada ANUSPLIN interpolated historical climate model from McKenney, D.W., M.F. Hutchinson, P. Papadol, K. Lawrence, J. Pedlar, K. Campbell, E. Milewska, R.F. Hopkinson, D. Price, and T. Owen, 2011. Customized Spatial Climate Models for North America. Bull. Amer. Meteor. Soc., 92, 1611-1622, https://doi.org/10.1175/2011BAMS3132.1</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_tgt</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Target regular grid&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/86b8afce85639e36a1d3b197a4c87b1b9c25152fc3e32b9c1f693b7f6fd223c2.png" src="../_images/86b8afce85639e36a1d3b197a4c87b1b9c25152fc3e32b9c1f693b7f6fd223c2.png" />
</div>
</div>
<p>xESMF relies on the useful <a class="reference external" href="https://cf-xarray.readthedocs.io/en/latest/">cf_xarray</a> package to infer which variables are the latitude and longitude points. It will automatically know to use <code class="docutils literal notranslate"><span class="pre">longitude</span></code> and <code class="docutils literal notranslate"><span class="pre">latitude</span></code> on the datasets because their attributes are correctly set, as <code class="docutils literal notranslate"><span class="pre">ds.cf.describe()</span></code>  shows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>

<span class="n">ds_in</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coordinates:
- CF Axes: * X: [&#39;i&#39;]
           * Y: [&#39;j&#39;]
           * T: [&#39;time&#39;]
             Z: n/a

- CF Coordinates:   longitude: [&#39;longitude&#39;]
                    latitude: [&#39;latitude&#39;]
                  * time: [&#39;time&#39;]
                    vertical: n/a

- Cell Measures:   area, volume: n/a

- Standard Names:   area_type: [&#39;type&#39;]
                    latitude: [&#39;latitude&#39;]
                    longitude: [&#39;longitude&#39;]
                  * time: [&#39;time&#39;]

- Bounds:   n/a

Data Variables:
- Cell Measures:   area: [&#39;areacello&#39;]
                   volume: n/a

- Standard Names:   cell_area: [&#39;areacello&#39;]
                    sea_ice_area_fraction: [&#39;siconc&#39;]

- Bounds:   T: [&#39;time_bnds&#39;]
            latitude: [&#39;vertices_latitude&#39;]
            longitude: [&#39;vertices_longitude&#39;]
            time: [&#39;time_bnds&#39;]
</pre></div>
</div>
</div>
</div>
<p>If those attributes were <strong>not</strong> set, we would need to rename the coordinates to <code class="docutils literal notranslate"><span class="pre">lon</span></code> and <code class="docutils literal notranslate"><span class="pre">lat</span></code>, xESMF’s default’s coordinate names.</p>
</section>
<section id="regridding-input-data-unto-the-output-grid">
<h3>Regridding input data unto the output grid<a class="headerlink" href="#regridding-input-data-unto-the-output-grid" title="Permalink to this heading">#</a></h3>
<p>First we create the regridding object, using the “bilinear” method, and then simply call it with the array that we want regridded (here <code class="docutils literal notranslate"><span class="pre">siconc</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_bil</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">ds_in</span><span class="p">,</span> <span class="n">ds_tgt</span><span class="p">,</span> <span class="s2">&quot;bilinear&quot;</span><span class="p">)</span>
<span class="n">reg_bil</span>  <span class="c1"># Show information about the regridding</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xESMF Regridder 
Regridding algorithm:       bilinear 
Weight filename:            bilinear_291x360_207x570.nc 
Reuse pre-computed weights? False 
Input grid shape:           (291, 360) 
Output grid shape:          (207, 570) 
Periodic in longitude?      False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># xesmf/frontend.py:476: FutureWarning: ``output_sizes`` should be given in the ``dask_gufunc_kwargs`` parameter. It will be removed as direct parameter in a future version.</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>

<span class="c1"># Apply the regridding weights to the input sea ice concentration data</span>
<span class="n">sic_bil</span> <span class="o">=</span> <span class="n">reg_bil</span><span class="p">(</span><span class="n">ds_in</span><span class="o">.</span><span class="n">siconc</span><span class="p">)</span>

<span class="c1"># Plot the results</span>
<span class="n">sic_bil</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Regridded sic data (Jan 2020)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/32d205e6f8032a4244db89c8ee84cd114863d368cab60941ea76d827844ff1d9.png" src="../_images/32d205e6f8032a4244db89c8ee84cd114863d368cab60941ea76d827844ff1d9.png" />
</div>
</div>
<p>The output now has the same grid as the target! The regridding operation was broadcasted along the non spatial dimensions (here <code class="docutils literal notranslate"><span class="pre">time</span></code>), so that all time steps were regridded using the same pre-computed weights.</p>
</section>
</section>
<section id="second-example-conservative-regridding-and-reusing-weights">
<h2>Second example : Conservative regridding and reusing weights<a class="headerlink" href="#second-example-conservative-regridding-and-reusing-weights" title="Permalink to this heading">#</a></h2>
<p>xESMF provides the following regridding methods : “bilinear”, “conservative”, “conservative_normed”, “nearest_s2d”, “nearest_d2s” and “patch” (see <a class="reference external" href="https://earthsystemmodeling.org/regrid/#regridding-methods">method descriptions</a>). Conservative methods preserve areal averages, and for these methods we need to provide the coordinates of the grid cells’ corners rather than the coordinates at the cells center.</p>
<section id="untangling-corners-definitions">
<h3>Untangling corners definitions<a class="headerlink" href="#untangling-corners-definitions" title="Permalink to this heading">#</a></h3>
<p>Before we go further, it’s worth highlighting differences between xESMF’s description of corner coordinates and how the same information is stored in CF-compliant files.</p>
<p>For an <code class="docutils literal notranslate"><span class="pre">N</span> <span class="pre">x</span> <span class="pre">M</span></code> lon/lat grid,  xESMF expects an array with one element more than the coordinates. For example, on a regular grid, the corner of point at <code class="docutils literal notranslate"><span class="pre">lon[0]</span></code> are given by <code class="docutils literal notranslate"><span class="pre">lon_b[0]</span></code> and <code class="docutils literal notranslate"><span class="pre">lon_b[1]</span></code>. However, in a typical CF-compliant file, <em>grid corner</em> information is in an array of shape (N, 2) typically called <code class="docutils literal notranslate"><span class="pre">lon_bounds</span></code> and <code class="docutils literal notranslate"><span class="pre">lat_bounds</span></code>. Thus, the western and eastern corners of point at <code class="docutils literal notranslate"><span class="pre">lon[0]</span></code> are given by <code class="docutils literal notranslate"><span class="pre">lon_corners[0,</span> <span class="pre">0]</span></code> and <code class="docutils literal notranslate"><span class="pre">lon_corners[0,</span> <span class="pre">1]</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> package differentiates the two concepts by naming the CF-compliant one “bounds” and the xESMF one “vertices”. However, CF conventions sometime uses vertices and bound interchangeably, and in our model dataset, the <code class="docutils literal notranslate"><span class="pre">vertices_longitude</span></code> variable stores corners according to the “bounds” definition…  We will nevetheless stick with <code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code>’s nomenclature in the following.</p>
<p>The table below summarizes the difference between the two versions:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>bounds</p></th>
<th class="head"><p>vertices</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CF-compliant</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>Shape (regular grid)</p></td>
<td><p>(N, 2)</p></td>
<td><p>(N+1,)</p></td>
</tr>
<tr class="row-even"><td><p>Shape (irregular grid)</p></td>
<td><p>(Nx, Ny, 4)</p></td>
<td><p>(Nx+1, Ny+1)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="computing-the-corners">
<h3>Computing the corners<a class="headerlink" href="#computing-the-corners" title="Permalink to this heading">#</a></h3>
<p>The corners of regular grids (1D lat/lon) are infered automatically if not given. This will be the case for our <code class="docutils literal notranslate"><span class="pre">ds_tgt</span></code> dataset.</p>
<p>For irregular grids, <code class="docutils literal notranslate"><span class="pre">xESMF</span></code> will check for variables <code class="docutils literal notranslate"><span class="pre">lon_b</span></code> and <code class="docutils literal notranslate"><span class="pre">lat_b</span></code>, or try automatic detection with the help of <code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code>. If they are found, it uses <code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code>’s method to convert from the CF-compliant “bounds” to the required “vertices” syntax. However, a small bug in xESMF 0.5.2 prevents use from using this feature with our model dataset. We will convert the corner variables ourselves from the CF-compliant format we have to the format xESMF expects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the bounds variable and convert them to &quot;vertices&quot; format</span>
<span class="c1"># Order=none, means that we do not know if the bounds are listed clockwise or counterclockwise, so we ask cf_xarray to try both.</span>
<span class="n">lat_corners</span> <span class="o">=</span> <span class="n">cfxr</span><span class="o">.</span><span class="n">bounds_to_vertices</span><span class="p">(</span><span class="n">ds_in</span><span class="o">.</span><span class="n">vertices_latitude</span><span class="p">,</span> <span class="s2">&quot;vertices&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">lon_corners</span> <span class="o">=</span> <span class="n">cfxr</span><span class="o">.</span><span class="n">bounds_to_vertices</span><span class="p">(</span><span class="n">ds_in</span><span class="o">.</span><span class="n">vertices_longitude</span><span class="p">,</span> <span class="s2">&quot;vertices&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ds_in_crns</span> <span class="o">=</span> <span class="n">ds_in</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">lon_b</span><span class="o">=</span><span class="n">lon_corners</span><span class="p">,</span> <span class="n">lat_b</span><span class="o">=</span><span class="n">lat_corners</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="regridding">
<h3>Regridding<a class="headerlink" href="#regridding" title="Permalink to this heading">#</a></h3>
<p>The regridding process is as simple as above now that <code class="docutils literal notranslate"><span class="pre">ds_in_crns</span></code> contains the corner coordinates (<code class="docutils literal notranslate"><span class="pre">lon_b</span></code>, <code class="docutils literal notranslate"><span class="pre">lat_b</span></code>). Here we also pass a filename, so that the weights are saved to disk and can be reused (see below).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">reg_cons</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span>
    <span class="n">ds_in_crns</span><span class="p">,</span> <span class="n">ds_tgt</span><span class="p">,</span> <span class="s2">&quot;conservative&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;conservative_regridder.nc&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reg_cons</span><span class="p">)</span>

<span class="c1"># Regrid as before</span>
<span class="n">sic_cons</span> <span class="o">=</span> <span class="n">reg_cons</span><span class="p">(</span><span class="n">ds_in_crns</span><span class="o">.</span><span class="n">siconc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xESMF Regridder 
Regridding algorithm:       conservative 
Weight filename:            conservative_regridder.nc 
Reuse pre-computed weights? False 
Input grid shape:           (291, 360) 
Output grid shape:          (207, 570) 
Periodic in longitude?      False
CPU times: user 4.74 s, sys: 44.5 ms, total: 4.78 s
Wall time: 4.78 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now let&#39;s look at the results</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">sic_bil</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Method: Bilinear&quot;</span><span class="p">)</span>

<span class="n">sic_cons</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Method: Conservative&quot;</span><span class="p">)</span>

<span class="c1"># A divergent colormap with gray on missing values</span>
<span class="n">cmap_div</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;RdBu&quot;</span><span class="p">))</span>
<span class="n">cmap_div</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">sic_bil</span> <span class="o">-</span> <span class="n">sic_cons</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_div</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">diff_NaNs</span> <span class="o">=</span> <span class="p">(</span><span class="n">sic_bil</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">^</span> <span class="n">sic_cons</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">diff_NaNs</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff_NaNs</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Greens</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Bilinear minus Conservative</span><span class="se">\n</span><span class="s2">Green indicates missing values in one but not the other&quot;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a013eb8d898871f5b06647efc9d9639fec8460e9122733b92bafbfea07161b32.png" src="../_images/a013eb8d898871f5b06647efc9d9639fec8460e9122733b92bafbfea07161b32.png" />
</div>
</div>
<p>As we can see, “bilinear” regridding results in a smooth output field, while “conservative” results preserves the original data’s coarser resolution. In the last panel, the green cells show that the two methods have different missing values results. In our case of increasing resolution, there will often be more missing values when using “bilinear”. The next example explains how xESMF can explictely manage missing values. But before, we look at the reusability of the weights generated by xESMF.</p>
</section>
<section id="reusing-weights">
<h3>Reusing weights<a class="headerlink" href="#reusing-weights" title="Permalink to this heading">#</a></h3>
<p>The weights of the previous regridding have been written to disk. We can simply reuse them by specifying that filename and passing <code class="docutils literal notranslate"><span class="pre">reuse_weights=True</span></code>. You’ll notice how faster the process is, as we don’t compute the weights again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">reg_bis</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span>
    <span class="n">ds_in_crns</span><span class="p">,</span>
    <span class="n">ds_tgt</span><span class="p">,</span>
    <span class="s2">&quot;conservative&quot;</span><span class="p">,</span>
    <span class="n">reuse_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;conservative_regridder.nc&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reg_bis</span><span class="p">)</span>

<span class="c1"># Regrid as before</span>
<span class="n">sic_bis</span> <span class="o">=</span> <span class="n">reg_bis</span><span class="p">(</span><span class="n">ds_in_crns</span><span class="o">.</span><span class="n">siconc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xESMF Regridder 
Regridding algorithm:       conservative 
Weight filename:            conservative_regridder.nc 
Reuse pre-computed weights? True 
Input grid shape:           (291, 360) 
Output grid shape:          (207, 570) 
Periodic in longitude?      False
CPU times: user 168 ms, sys: 37.9 ms, total: 206 ms
Wall time: 164 ms
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="third-example-regridding-and-masks">
<h2>Third example : Regridding and masks<a class="headerlink" href="#third-example-regridding-and-masks" title="Permalink to this heading">#</a></h2>
<p>By defaut, xESMF doesn’t handle missing values in a special way, so when they are present in the input data they often bleed into the regridded field, especially when decreasing resolution. This example demonstrates this bleeding effect and how it can be mitigated using masks.</p>
<p>We will use a global model dataset and try to regrid the NRCAN observation unto the global grid, thus decreasing the resolution.</p>
<section id="target-grid-and-mask">
<h3>Target grid and mask<a class="headerlink" href="#target-grid-and-mask" title="Permalink to this heading">#</a></h3>
<p>The target grid will be the CanESM2 model grid, but with the ocean masked. In the following, we fetch both the “tasmin” data for the same date as the obs and the “sftlf” mask so we can obtain a land mask (land fraction above 0.25).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>

<span class="c1"># Model data for tasmin</span>
<span class="n">ds_tgt</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="s2">&quot;https://pavics.ouranos.ca/twitcher/ows/proxy/thredds/dodsC/birdhouse/cccma/CanESM2/historical/day/atmos/r1i1p1/tasmin/tasmin_day_CanESM2_historical_r1i1p1_18500101-20051231.nc&quot;</span>
<span class="p">)</span>
<span class="c1"># Land-sea fraction</span>
<span class="n">ds_sftlf</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="s2">&quot;https://pavics.ouranos.ca/twitcher/ows/proxy/thredds/dodsC/birdhouse/cccma/CanESM2/historical/fx/atmos/r0i0p0/sftlf/sftlf_fx_CanESM2_historical_r0i0p0.nc&quot;</span>
<span class="p">)</span>
<span class="n">ds_tgt</span> <span class="o">=</span> <span class="n">ds_tgt</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s2">&quot;1993-05-20&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>  <span class="c1"># Extract same day as obs</span>
<span class="n">ds_tgt</span> <span class="o">=</span> <span class="n">ds_tgt</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">bnds</span><span class="o">=</span><span class="s2">&quot;bounds&quot;</span><span class="p">)</span>  <span class="c1"># Small fix for xESMF 0.5.2</span>
<span class="n">ds_tgt</span><span class="p">[</span><span class="s2">&quot;tasmin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_tgt</span><span class="o">.</span><span class="n">tasmin</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">ds_sftlf</span><span class="o">.</span><span class="n">sftlf</span> <span class="o">&gt;</span> <span class="mf">0.25</span>
<span class="p">)</span>  <span class="c1"># Mask tasmin data that is over the ocean</span>
<span class="n">ds_tgt</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:    (time: 1, bounds: 2, lat: 64, lon: 128)
Coordinates:
  * lat        (lat) float64 -87.86 -85.1 -82.31 -79.53 ... 82.31 85.1 87.86
  * lon        (lon) float64 0.0 2.812 5.625 8.438 ... 348.8 351.6 354.4 357.2
    height     float64 2.0
Dimensions without coordinates: time, bounds
Data variables:
    time_bnds  (time, bounds) object 1993-05-20 00:00:00 1993-05-21 00:00:00
    lat_bnds   (lat, bounds) float64 -90.0 -86.48 -86.48 ... 86.48 86.48 90.0
    lon_bnds   (lon, bounds) float64 -1.406 1.406 1.406 ... 355.8 355.8 358.6
    tasmin     (time, lat, lon) float32 208.3 207.9 207.4 206.8 ... nan nan nan
Attributes: (12/32)
    institution:                     CCCma (Canadian Centre for Climate Model...
    institute_id:                    CCCma
    experiment_id:                   historical
    source:                          CanESM2 2010 atmosphere: CanAM4 (AGCM15i...
    model_id:                        CanESM2
    forcing:                         GHG,Oz,SA,BC,OC,LU,Sl,Vl (GHG includes C...
    ...                              ...
    title:                           CanESM2 model output prepared for CMIP5 ...
    parent_experiment:               pre-industrial control
    modeling_realm:                  atmos
    realization:                     1
    cmor_version:                    2.5.4
    DODS_EXTRA.Unlimited_Dimension:  time</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-e2ba32ec-ac5b-42f1-8014-277962ff9db5' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-e2ba32ec-ac5b-42f1-8014-277962ff9db5' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span>time</span>: 1</li><li><span>bounds</span>: 2</li><li><span class='xr-has-index'>lat</span>: 64</li><li><span class='xr-has-index'>lon</span>: 128</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-ab37457b-fdc8-4d34-8c1f-1a79f369ae85' class='xr-section-summary-in' type='checkbox'  checked><label for='section-ab37457b-fdc8-4d34-8c1f-1a79f369ae85' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-87.86 -85.1 -82.31 ... 85.1 87.86</div><input id='attrs-151074b9-3b0a-482c-948c-65eefb50c216' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-151074b9-3b0a-482c-948c-65eefb50c216' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bfcb2985-c0db-4f23-a326-ea9bae4a42e9' class='xr-var-data-in' type='checkbox'><label for='data-bfcb2985-c0db-4f23-a326-ea9bae4a42e9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>bounds :</span></dt><dd>lat_bnds</dd><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>axis :</span></dt><dd>Y</dd><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>standard_name :</span></dt><dd>latitude</dd></dl></div><div class='xr-var-data'><pre>array([-87.863801, -85.096529, -82.312915, -79.525609, -76.736902, -73.947518,
       -71.157755, -68.367759, -65.57761 , -62.787354, -59.997023, -57.206634,
       -54.416202, -51.625736, -48.835243, -46.044729, -43.254197, -40.463651,
       -37.673092, -34.882523, -32.091946, -29.301362, -26.510772, -23.720176,
       -20.929577, -18.138973, -15.348367, -12.557759,  -9.767148,  -6.976536,
        -4.185923,  -1.395309,   1.395309,   4.185923,   6.976536,   9.767148,
        12.557759,  15.348367,  18.138973,  20.929577,  23.720176,  26.510772,
        29.301362,  32.091946,  34.882523,  37.673092,  40.463651,  43.254197,
        46.044729,  48.835243,  51.625736,  54.416202,  57.206634,  59.997023,
        62.787354,  65.57761 ,  68.367759,  71.157755,  73.947518,  76.736902,
        79.525609,  82.312915,  85.096529,  87.863801])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 2.812 5.625 ... 354.4 357.2</div><input id='attrs-62d913ac-349a-4bf7-ab9f-a7459c67d056' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-62d913ac-349a-4bf7-ab9f-a7459c67d056' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3af9e939-2d82-47de-8c77-634025083339' class='xr-var-data-in' type='checkbox'><label for='data-3af9e939-2d82-47de-8c77-634025083339' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>bounds :</span></dt><dd>lon_bnds</dd><dt><span>units :</span></dt><dd>degrees_east</dd><dt><span>axis :</span></dt><dd>X</dd><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>standard_name :</span></dt><dd>longitude</dd></dl></div><div class='xr-var-data'><pre>array([  0.    ,   2.8125,   5.625 ,   8.4375,  11.25  ,  14.0625,  16.875 ,
        19.6875,  22.5   ,  25.3125,  28.125 ,  30.9375,  33.75  ,  36.5625,
        39.375 ,  42.1875,  45.    ,  47.8125,  50.625 ,  53.4375,  56.25  ,
        59.0625,  61.875 ,  64.6875,  67.5   ,  70.3125,  73.125 ,  75.9375,
        78.75  ,  81.5625,  84.375 ,  87.1875,  90.    ,  92.8125,  95.625 ,
        98.4375, 101.25  , 104.0625, 106.875 , 109.6875, 112.5   , 115.3125,
       118.125 , 120.9375, 123.75  , 126.5625, 129.375 , 132.1875, 135.    ,
       137.8125, 140.625 , 143.4375, 146.25  , 149.0625, 151.875 , 154.6875,
       157.5   , 160.3125, 163.125 , 165.9375, 168.75  , 171.5625, 174.375 ,
       177.1875, 180.    , 182.8125, 185.625 , 188.4375, 191.25  , 194.0625,
       196.875 , 199.6875, 202.5   , 205.3125, 208.125 , 210.9375, 213.75  ,
       216.5625, 219.375 , 222.1875, 225.    , 227.8125, 230.625 , 233.4375,
       236.25  , 239.0625, 241.875 , 244.6875, 247.5   , 250.3125, 253.125 ,
       255.9375, 258.75  , 261.5625, 264.375 , 267.1875, 270.    , 272.8125,
       275.625 , 278.4375, 281.25  , 284.0625, 286.875 , 289.6875, 292.5   ,
       295.3125, 298.125 , 300.9375, 303.75  , 306.5625, 309.375 , 312.1875,
       315.    , 317.8125, 320.625 , 323.4375, 326.25  , 329.0625, 331.875 ,
       334.6875, 337.5   , 340.3125, 343.125 , 345.9375, 348.75  , 351.5625,
       354.375 , 357.1875])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>height</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-6df8d7bd-af94-4e0c-8bef-e3a1d62d483d' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-6df8d7bd-af94-4e0c-8bef-e3a1d62d483d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-98edd2a0-91df-442f-a27b-e7a62d9653c3' class='xr-var-data-in' type='checkbox'><label for='data-98edd2a0-91df-442f-a27b-e7a62d9653c3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>m</dd><dt><span>axis :</span></dt><dd>Z</dd><dt><span>positive :</span></dt><dd>up</dd><dt><span>long_name :</span></dt><dd>height</dd><dt><span>standard_name :</span></dt><dd>height</dd></dl></div><div class='xr-var-data'><pre>array(2.)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-bb12d923-3ef1-44de-b7bc-b3245b135efa' class='xr-section-summary-in' type='checkbox'  checked><label for='section-bb12d923-3ef1-44de-b7bc-b3245b135efa' class='xr-section-summary' >Data variables: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>time_bnds</span></div><div class='xr-var-dims'>(time, bounds)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-0bb49e05-78c8-4416-a37b-7a8425ba3a10' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0bb49e05-78c8-4416-a37b-7a8425ba3a10' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1041853f-e57c-4ccd-af7d-c46c0cfaf2a2' class='xr-var-data-in' type='checkbox'><label for='data-1041853f-e57c-4ccd-af7d-c46c0cfaf2a2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[cftime.DatetimeNoLeap(1993, 5, 20, 0, 0, 0, 0, has_year_zero=True),
        cftime.DatetimeNoLeap(1993, 5, 21, 0, 0, 0, 0, has_year_zero=True)]],
      dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>lat_bnds</span></div><div class='xr-var-dims'>(lat, bounds)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-33d77e0a-14dd-406a-be5a-d7eb0a8eef82' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-33d77e0a-14dd-406a-be5a-d7eb0a8eef82' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-20a22c6f-7625-4476-a7d6-481265322cc3' class='xr-var-data-in' type='checkbox'><label for='data-20a22c6f-7625-4476-a7d6-481265322cc3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[-90.      , -86.480165],
       [-86.480165, -83.704722],
       [-83.704722, -80.919262],
       [-80.919262, -78.131256],
       [-78.131256, -75.34221 ],
       [-75.34221 , -72.552636],
       [-72.552636, -69.762757],
       [-69.762757, -66.972684],
       [-66.972684, -64.182482],
       [-64.182482, -61.392188],
       [-61.392188, -58.601828],
       [-58.601828, -55.811418],
       [-55.811418, -53.020969],
       [-53.020969, -50.23049 ],
       [-50.23049 , -47.439986],
       [-47.439986, -44.649463],
       [-44.649463, -41.858924],
       [-41.858924, -39.068371],
       [-39.068371, -36.277808],
       [-36.277808, -33.487235],
       [-33.487235, -30.696654],
       [-30.696654, -27.906067],
       [-27.906067, -25.115474],
       [-25.115474, -22.324877],
       [-22.324877, -19.534275],
       [-19.534275, -16.74367 ],
       [-16.74367 , -13.953063],
       [-13.953063, -11.162453],
       [-11.162453,  -8.371842],
       [ -8.371842,  -5.58123 ],
       [ -5.58123 ,  -2.790616],
       [ -2.790616,   0.      ],
       [  0.      ,   2.790616],
       [  2.790616,   5.58123 ],
       [  5.58123 ,   8.371842],
       [  8.371842,  11.162453],
       [ 11.162453,  13.953063],
       [ 13.953063,  16.74367 ],
       [ 16.74367 ,  19.534275],
       [ 19.534275,  22.324877],
       [ 22.324877,  25.115474],
       [ 25.115474,  27.906067],
       [ 27.906067,  30.696654],
       [ 30.696654,  33.487235],
       [ 33.487235,  36.277808],
       [ 36.277808,  39.068371],
       [ 39.068371,  41.858924],
       [ 41.858924,  44.649463],
       [ 44.649463,  47.439986],
       [ 47.439986,  50.23049 ],
       [ 50.23049 ,  53.020969],
       [ 53.020969,  55.811418],
       [ 55.811418,  58.601828],
       [ 58.601828,  61.392188],
       [ 61.392188,  64.182482],
       [ 64.182482,  66.972684],
       [ 66.972684,  69.762757],
       [ 69.762757,  72.552636],
       [ 72.552636,  75.34221 ],
       [ 75.34221 ,  78.131256],
       [ 78.131256,  80.919262],
       [ 80.919262,  83.704722],
       [ 83.704722,  86.480165],
       [ 86.480165,  90.      ]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>lon_bnds</span></div><div class='xr-var-dims'>(lon, bounds)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-3f6b248a-8dd8-4e9c-80ee-c216260dfd74' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3f6b248a-8dd8-4e9c-80ee-c216260dfd74' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d618debd-3e12-4380-8a70-bdcc3c0a3419' class='xr-var-data-in' type='checkbox'><label for='data-d618debd-3e12-4380-8a70-bdcc3c0a3419' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ -1.40625,   1.40625],
       [  1.40625,   4.21875],
       [  4.21875,   7.03125],
       ...,
       [350.15625, 352.96875],
       [352.96875, 355.78125],
       [355.78125, 358.59375]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tasmin</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>208.3 207.9 207.4 ... nan nan nan</div><input id='attrs-a159be79-314e-4508-99fe-232b6288c4fa' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a159be79-314e-4508-99fe-232b6288c4fa' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-32ed865b-d37c-4d1f-8614-555c99471719' class='xr-var-data-in' type='checkbox'><label for='data-32ed865b-d37c-4d1f-8614-555c99471719' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>air_temperature</dd><dt><span>long_name :</span></dt><dd>Daily Minimum Near-Surface Air Temperature</dd><dt><span>units :</span></dt><dd>K</dd><dt><span>original_name :</span></dt><dd>STMN</dd><dt><span>cell_methods :</span></dt><dd>time: minimum (interval: 15 minutes)</dd><dt><span>cell_measures :</span></dt><dd>area: areacella</dd><dt><span>history :</span></dt><dd>2011-04-14T00:23:54Z altered by CMOR: Treated scalar dimension: &#x27;height&#x27;. 2011-04-14T00:23:54Z altered by CMOR: replaced missing value flag (1e+38) with standard missing value (1e+20).</dd><dt><span>associated_files :</span></dt><dd>baseURL: http://cmip-pcmdi.llnl.gov/CMIP5/dataLocation gridspecFile: gridspec_atmos_fx_CanESM2_historical_r0i0p0.nc areacella: areacella_fx_CanESM2_historical_r0i0p0.nc</dd></dl></div><div class='xr-var-data'><pre>array([[[208.26923, 207.8905 , 207.408  , ..., 209.4509 , 209.03212,
         208.63884],
        [206.06064, 205.12477, 204.41832, ..., 210.12457, 208.56055,
         207.21501],
        [205.3287 , 204.32547, 203.43512, ..., 210.56339, 208.37483,
         206.63419],
        ...,
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan]]], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-4e54a56a-1b41-42e3-9813-4a1dcbf1f644' class='xr-section-summary-in' type='checkbox'  ><label for='section-4e54a56a-1b41-42e3-9813-4a1dcbf1f644' class='xr-section-summary' >Attributes: <span>(32)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>institution :</span></dt><dd>CCCma (Canadian Centre for Climate Modelling and Analysis, Victoria, BC, Canada)</dd><dt><span>institute_id :</span></dt><dd>CCCma</dd><dt><span>experiment_id :</span></dt><dd>historical</dd><dt><span>source :</span></dt><dd>CanESM2 2010 atmosphere: CanAM4 (AGCM15i, T63L35) ocean: CanOM4 (OGCM4.0, 256x192L40) and CMOC1.2 sea ice: CanSIM1 (Cavitating Fluid, T63 Gaussian Grid) land: CLASS2.7 and CTEM1</dd><dt><span>model_id :</span></dt><dd>CanESM2</dd><dt><span>forcing :</span></dt><dd>GHG,Oz,SA,BC,OC,LU,Sl,Vl (GHG includes CO2,CH4,N2O,CFC11,effective CFC12)</dd><dt><span>parent_experiment_id :</span></dt><dd>piControl</dd><dt><span>parent_experiment_rip :</span></dt><dd>r1i1p1</dd><dt><span>branch_time :</span></dt><dd>171915.0</dd><dt><span>contact :</span></dt><dd>cccma_info@ec.gc.ca</dd><dt><span>references :</span></dt><dd>http://www.cccma.ec.gc.ca/models</dd><dt><span>initialization_method :</span></dt><dd>1</dd><dt><span>physics_version :</span></dt><dd>1</dd><dt><span>tracking_id :</span></dt><dd>41050cdf-8acf-4227-a192-3264026d45de</dd><dt><span>branch_time_YMDH :</span></dt><dd>2321:01:01:00</dd><dt><span>CCCma_runid :</span></dt><dd>IGM</dd><dt><span>CCCma_parent_runid :</span></dt><dd>IGA</dd><dt><span>CCCma_data_licence :</span></dt><dd>1) GRANT OF LICENCE - The Government of Canada (Environment Canada) is the 
owner of all intellectual property rights (including copyright) that may exist in this Data 
product. You (as &quot;The Licensee&quot;) are hereby granted a non-exclusive, non-assignable, 
non-transferable unrestricted licence to use this data product for any purpose including 
the right to share these data with others and to make value-added and derivative 
products from it. This licence is not a sale of any or all of the owner&#x27;s rights.
2) NO WARRANTY - This Data product is provided &quot;as-is&quot;; it has not been designed or 
prepared to meet the Licensee&#x27;s particular requirements. Environment Canada makes no 
warranty, either express or implied, including but not limited to, warranties of 
merchantability and fitness for a particular purpose. In no event will Environment Canada 
be liable for any indirect, special, consequential or other damages attributed to the 
Licensee&#x27;s use of the Data product.</dd><dt><span>product :</span></dt><dd>output</dd><dt><span>experiment :</span></dt><dd>historical</dd><dt><span>frequency :</span></dt><dd>day</dd><dt><span>creation_date :</span></dt><dd>2011-04-14T00:23:54Z</dd><dt><span>history :</span></dt><dd>2011-04-14T00:23:54Z CMOR rewrote data to comply with CF standards and CMIP5 requirements.</dd><dt><span>Conventions :</span></dt><dd>CF-1.4</dd><dt><span>project_id :</span></dt><dd>CMIP5</dd><dt><span>table_id :</span></dt><dd>Table day (28 March 2011) f9d6cfec5981bb8be1801b35a81002f0</dd><dt><span>title :</span></dt><dd>CanESM2 model output prepared for CMIP5 historical</dd><dt><span>parent_experiment :</span></dt><dd>pre-industrial control</dd><dt><span>modeling_realm :</span></dt><dd>atmos</dd><dt><span>realization :</span></dt><dd>1</dd><dt><span>cmor_version :</span></dt><dd>2.5.4</dd><dt><span>DODS_EXTRA.Unlimited_Dimension :</span></dt><dd>time</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>

<span class="c1"># Input grid and data : reuse ds_obs (NRCAN but without the subsetting)</span>
<span class="n">ds_in</span> <span class="o">=</span> <span class="n">ds_obs</span><span class="p">[[</span><span class="s2">&quot;tasmin&quot;</span><span class="p">]]</span>
<span class="n">ds_in</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  (lat: 510, lon: 1068)
Coordinates:
  * lat      (lat) float32 83.46 83.38 83.29 83.21 ... 41.29 41.21 41.12 41.04
  * lon      (lon) float32 -141.0 -140.9 -140.8 -140.7 ... -52.21 -52.13 -52.04
Data variables:
    tasmin   (lat, lon) float32 ...
Attributes: (12/15)
    Conventions:          CF-1.5
    title:                NRCAN ANUSPLIN daily gridded dataset : version 2
    history:              Fri Jan 25 14:11:15 2019 : Convert from original fo...
    institute_id:         NRCAN
    frequency:            day
    abstract:             Gridded daily observational dataset produced by Nat...
    ...                   ...
    dataset_id:           NRCAN_anusplin_daily_v2
    version:              2.0
    license_type:         permissive
    license:              https://open.canada.ca/en/open-government-licence-c...
    attribution:          The authors provide this data under the Environment...
    citation:             Natural Resources Canada ANUSPLIN interpolated hist...</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-35cd6786-e712-417f-ad88-db1f4ac7d428' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-35cd6786-e712-417f-ad88-db1f4ac7d428' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>lat</span>: 510</li><li><span class='xr-has-index'>lon</span>: 1068</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-286bf15e-adc3-47cc-bb00-6aa8e12f5f92' class='xr-section-summary-in' type='checkbox'  checked><label for='section-286bf15e-adc3-47cc-bb00-6aa8e12f5f92' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>83.46 83.38 83.29 ... 41.12 41.04</div><input id='attrs-4ad65169-85c0-4eb4-8b62-d2fd778381d8' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-4ad65169-85c0-4eb4-8b62-d2fd778381d8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-98eb912a-6cb0-4262-9828-5749e9bc2021' class='xr-var-data-in' type='checkbox'><label for='data-98eb912a-6cb0-4262-9828-5749e9bc2021' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>Y</dd><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>_ChunkSizes :</span></dt><dd>510</dd></dl></div><div class='xr-var-data'><pre>array([83.45833 , 83.375   , 83.291664, ..., 41.208332, 41.125   , 41.041668],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-141.0 -140.9 ... -52.13 -52.04</div><input id='attrs-9ad8adb7-ac45-41c2-85ca-081e6c09faee' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-9ad8adb7-ac45-41c2-85ca-081e6c09faee' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6b8767ca-29ef-490c-899a-91093619ac4f' class='xr-var-data-in' type='checkbox'><label for='data-6b8767ca-29ef-490c-899a-91093619ac4f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>X</dd><dt><span>units :</span></dt><dd>degrees_east</dd><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>_ChunkSizes :</span></dt><dd>1068</dd></dl></div><div class='xr-var-data'><pre>array([-140.95833 , -140.875   , -140.79167 , ...,  -52.208336,  -52.125004,
        -52.04167 ], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-36cbfa52-ad5e-4864-b816-f5bd2278e715' class='xr-section-summary-in' type='checkbox'  checked><label for='section-36cbfa52-ad5e-4864-b816-f5bd2278e715' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>tasmin</span></div><div class='xr-var-dims'>(lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-c16f6114-b913-4703-b8dc-6e21c9696fb7' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c16f6114-b913-4703-b8dc-6e21c9696fb7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-41611a29-9920-4fd5-9765-bd2805127ef2' class='xr-var-data-in' type='checkbox'><label for='data-41611a29-9920-4fd5-9765-bd2805127ef2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>K</dd><dt><span>long_name :</span></dt><dd>air_temperature</dd><dt><span>standard_name :</span></dt><dd>air_temperature</dd><dt><span>_ChunkSizes :</span></dt><dd>[366  50  50]</dd></dl></div><div class='xr-var-data'><pre>[544680 values with dtype=float32]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-f75fd991-fb8b-4daf-bb55-78f068af186f' class='xr-section-summary-in' type='checkbox'  ><label for='section-f75fd991-fb8b-4daf-bb55-78f068af186f' class='xr-section-summary' >Attributes: <span>(15)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>CF-1.5</dd><dt><span>title :</span></dt><dd>NRCAN ANUSPLIN daily gridded dataset : version 2</dd><dt><span>history :</span></dt><dd>Fri Jan 25 14:11:15 2019 : Convert from original format to NetCDF</dd><dt><span>institute_id :</span></dt><dd>NRCAN</dd><dt><span>frequency :</span></dt><dd>day</dd><dt><span>abstract :</span></dt><dd>Gridded daily observational dataset produced by Natural Resources Canada (NRCan), available at 300 arc second spatial resolution (1/12° grids, ~10 km) over Canada. The version 2 dataset was updated in its entirety compared with version 1 and is not a simple extension of version 1 with additional years of data. Gridding was accomplished with the Australian National University Spline (ANUSPLIN) implementation of the trivariate thin plate splines interpolation method with latitude, longitude and elevation as predictors. </dd><dt><span>dataset_description :</span></dt><dd>https://cfs.nrcan.gc.ca/projects/3/1</dd><dt><span>type :</span></dt><dd>gridded_obs</dd><dt><span>institute :</span></dt><dd>Natural Resources Canada : Canadian Forest Service</dd><dt><span>dataset_id :</span></dt><dd>NRCAN_anusplin_daily_v2</dd><dt><span>version :</span></dt><dd>2.0</dd><dt><span>license_type :</span></dt><dd>permissive</dd><dt><span>license :</span></dt><dd>https://open.canada.ca/en/open-government-licence-canada</dd><dt><span>attribution :</span></dt><dd>The authors provide this data under the Environment and Climate Change Canada Data Server End Use License and demand that any references to or derivative works based on this dataset be cited using the provided citation information</dd><dt><span>citation :</span></dt><dd>Natural Resources Canada ANUSPLIN interpolated historical climate model from McKenney, D.W., M.F. Hutchinson, P. Papadol, K. Lawrence, J. Pedlar, K. Campbell, E. Milewska, R.F. Hopkinson, D. Price, and T. Owen, 2011. Customized Spatial Climate Models for North America. Bull. Amer. Meteor. Soc., 92, 1611-1622, https://doi.org/10.1175/2011BAMS3132.1</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">ds_in</span><span class="o">.</span><span class="n">tasmin</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;NRCAN Input grid&quot;</span><span class="p">)</span>

<span class="n">ds_tgt</span><span class="o">.</span><span class="n">tasmin</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Target CanESM2 grid&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7b29a821a4facc148e7bf208c80f2752dfa82dd30363d8db8fc2b5b0cf46ea8c.png" src="../_images/7b29a821a4facc148e7bf208c80f2752dfa82dd30363d8db8fc2b5b0cf46ea8c.png" />
</div>
</div>
</section>
<section id="default-regridding-no-mask-handling">
<h3>Default regridding - No mask handling<a class="headerlink" href="#default-regridding-no-mask-handling" title="Permalink to this heading">#</a></h3>
<p>We first naïvely try the regridding exactly as before. Here we use the “conservative_normed” method, the reason is explained at the end of the example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_nomask</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">ds_in</span><span class="p">,</span> <span class="n">ds_tgt</span><span class="p">,</span> <span class="s2">&quot;conservative_normed&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reg_nomask</span><span class="p">)</span>
<span class="n">tasmin_nomask</span> <span class="o">=</span> <span class="n">reg_nomask</span><span class="p">(</span><span class="n">ds_in</span><span class="o">.</span><span class="n">tasmin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xESMF Regridder 
Regridding algorithm:       conservative_normed 
Weight filename:            conservative_normed_510x1068_64x128.nc 
Reuse pre-computed weights? False 
Input grid shape:           (510, 1068) 
Output grid shape:          (64, 128) 
Periodic in longitude?      False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">tasmin_nomask</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Regridded NRCAN - No mask handling&quot;</span><span class="p">)</span>

<span class="n">tasmin_nomask</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">210</span><span class="p">,</span> <span class="mi">320</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">86</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Zoom on Canada + Color rescaling&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b161360aa8b036a7cbdb666adc5ee55f0578432ea42b7dc21da893294bdd7a7a.png" src="../_images/b161360aa8b036a7cbdb666adc5ee55f0578432ea42b7dc21da893294bdd7a7a.png" />
</div>
</div>
<p>This ugly result is the default behaviour of xESMF when no mask information is passed :</p>
<ol class="arabic simple">
<li><p>A single missing value in the input suffices so that the target (coarser) grid cell is marked as missing. This erased all the Canadian Arctic Archipelago and most points near the sea in general.</p></li>
<li><p>Grid points outside the input grid are filled with 0s instead of NaNs.</p></li>
</ol>
<p>To resolve this, we pass as binary mask to xESMF. xESMF will then exclude the masked values from the computation, and this way the small islands in the Canadian Arctic Archipelago won’t be hidden by missing values. It will also activate a mode where values outside the input grid are marked as missing (NaN), which is usually more useful.</p>
<p>Note that ESMF masks defined as <code class="docutils literal notranslate"><span class="pre">True</span></code> where data is valid, and <code class="docutils literal notranslate"><span class="pre">False</span></code> where it is missing. The variable must be named <code class="docutils literal notranslate"><span class="pre">mask</span></code> to get picked up by xESMF.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the masks and assign them as variables for both the input and output datasets.</span>
<span class="n">in_mask</span> <span class="o">=</span> <span class="n">ds_in</span><span class="o">.</span><span class="n">tasmin</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
<span class="n">ds_in_mask</span> <span class="o">=</span> <span class="n">ds_in</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="n">in_mask</span><span class="p">)</span>

<span class="n">tgt_mask</span> <span class="o">=</span> <span class="n">ds_tgt</span><span class="o">.</span><span class="n">tasmin</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
<span class="n">ds_tgt_mask</span> <span class="o">=</span> <span class="n">ds_tgt</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="n">tgt_mask</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">in_mask</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">binary_r</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tgt_mask</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">binary_r</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Input grid mask&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Target grid mask&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6c96f62d5c899280b37a10e7b8bdd66912602cfdbed244af2b782d3cebb9f52c.png" src="../_images/6c96f62d5c899280b37a10e7b8bdd66912602cfdbed244af2b782d3cebb9f52c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_mask</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">ds_in_mask</span><span class="p">,</span> <span class="n">ds_tgt_mask</span><span class="p">,</span> <span class="s2">&quot;conservative_normed&quot;</span><span class="p">)</span>
<span class="n">reg_mask</span>  <span class="c1"># Show information about the regriddingaa</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xESMF Regridder 
Regridding algorithm:       conservative_normed 
Weight filename:            conservative_normed_510x1068_64x128.nc 
Reuse pre-computed weights? False 
Input grid shape:           (510, 1068) 
Output grid shape:          (64, 128) 
Periodic in longitude?      False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tasmin_mask</span> <span class="o">=</span> <span class="n">reg_mask</span><span class="p">(</span><span class="n">ds_in_mask</span><span class="o">.</span><span class="n">tasmin</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">tasmin_mask</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Regridded NRCAN - With mask handling&quot;</span><span class="p">)</span>

<span class="n">tasmin_mask</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">210</span><span class="p">,</span> <span class="mi">320</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">86</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Zoom on Canada&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4caa1e4698920950c35adeef74d7a3cd8b7cac45d12a96681f66d1444d079722.png" src="../_images/4caa1e4698920950c35adeef74d7a3cd8b7cac45d12a96681f66d1444d079722.png" />
</div>
</div>
<p>Much better! As expected, grid cells near the sea are kept and points outside the input grid are marked as missing.</p>
</section>
<section id="normalization-for-conservative-regridding">
<h3>Normalization for conservative regridding<a class="headerlink" href="#normalization-for-conservative-regridding" title="Permalink to this heading">#</a></h3>
<p>The “conservative_normed” method includes information about the missing values in the final normalization of the data. On the other hand, the “conservative” method normalizes using the total area of the target cell, no matter how many input grid points were valid. The following figure shows how that can lead to large biases in the data near the boundaries. Indeed, in the example below, the temperatures reach values close to 0 Kelvins near the boundaries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_mask_cons</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">ds_in_mask</span><span class="p">,</span> <span class="n">ds_tgt_mask</span><span class="p">,</span> <span class="s2">&quot;conservative&quot;</span><span class="p">)</span>
<span class="n">tasmin_mask_cons</span> <span class="o">=</span> <span class="n">reg_mask_cons</span><span class="p">(</span><span class="n">ds_in_mask</span><span class="o">.</span><span class="n">tasmin</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">tasmin_mask_cons</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">210</span><span class="p">,</span> <span class="mi">320</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">86</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Conservative regridding without normalization - zoom on Canada&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="s2">&quot;Some values are close to 0 Kelvins.</span><span class="se">\n</span><span class="s2">Canada can get cold, but not that cold!&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">280</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
    <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
    <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;axes fraction&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;x-large&quot;</span><span class="p">,</span>
    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3, rad=-0.3&quot;</span><span class="p">),</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4cc591946198e02815ec5a8ff1406d2e4223de3e3bdc06876dc9d145285e007e.png" src="../_images/4cc591946198e02815ec5a8ff1406d2e4223de3e3bdc06876dc9d145285e007e.png" />
</div>
</div>
</section>
</section>
<section id="fourth-example-averaging-over-polygons">
<h2>Fourth example : Averaging over polygons<a class="headerlink" href="#fourth-example-averaging-over-polygons" title="Permalink to this heading">#</a></h2>
<p>Because the conservative regridding method preserves areal averages, we can use xESMF to compute <em>exact</em> averages over polygons. We call it “exact” because is takes into account partial overlaps between the gridcells and the shapes, including potential holes. While it is fast and powerful, this polygon averaging functionality is new in xESMF and still lacks some features, like missing values handling and performance issues with high-resolution polygons.</p>
<p>The following example grabs some polygon shapes from PAVICS’ Geoserver and averages the NRCAN data over them.</p>
<section id="define-polygon-shapes">
<h3>Define polygon shapes<a class="headerlink" href="#define-polygon-shapes" title="Permalink to this heading">#</a></h3>
<p>This example fetches all MRC of Québec and then only selects 10 large ones.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wfs_url</span> <span class="o">=</span> <span class="s2">&quot;https://pavics.ouranos.ca/geoserver/wfs&quot;</span>  <span class="c1"># TEST_USE_PROD_DATA</span>
<span class="c1"># # Connect to GeoServer WFS service.</span>
<span class="n">wfs</span> <span class="o">=</span> <span class="n">WebFeatureService</span><span class="p">(</span><span class="n">wfs_url</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;2.0.0&quot;</span><span class="p">)</span>
<span class="c1"># Get the json as a binary stream</span>
<span class="c1"># Here we select Quebec&#39;s MRCs polygons</span>
<span class="c1"># We select only a few properties</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">wfs</span><span class="o">.</span><span class="n">getfeature</span><span class="p">(</span>
    <span class="n">typename</span><span class="o">=</span><span class="s2">&quot;public:quebec_mrc_boundaries&quot;</span><span class="p">,</span>
    <span class="c1"># bbox=(-93.1, 41.1, -75.0, 49.6),</span>
    <span class="n">outputFormat</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
    <span class="n">propertyname</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;the_geom&quot;</span><span class="p">,</span> <span class="s2">&quot;MRS_NM_MRC&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># Load into a GeoDataFrame by reading the json on-the-fly</span>
<span class="n">shapes_all</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="c1"># Just for simplicity, let&#39;s take 10 large MRCs</span>
<span class="n">shapes_all</span><span class="p">[</span><span class="s2">&quot;AREA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shapes_all</span><span class="o">.</span><span class="n">area</span>
<span class="n">shapes</span> <span class="o">=</span> <span class="n">shapes_all</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;AREA&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;MRS_NM_MRC&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="validate-and-simplify-shapes">
<h3>Validate and simplify shapes<a class="headerlink" href="#validate-and-simplify-shapes" title="Permalink to this heading">#</a></h3>
<p>High resolution polygons might slow down the creation of the xESMf averager object. Here we ensure polygons are simplified to a resolution 50x times finer than the input data. This should have a minimal impact on the output while still improving performance.</p>
<p>As it is the case here, downloaded polygons sometime have topological problems which can be tested with <code class="docutils literal notranslate"><span class="pre">shapes.is_valid</span></code>. Simplifying polygons sometimes help overcome these issues:  here, we simplify with a tolerance of 1/100th of the grid size. Another workaround for self-intersections is to call <code class="docutils literal notranslate"><span class="pre">shapes.buffer(0)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>
<span class="n">shapes</span><span class="o">.</span><span class="n">is_valid</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is only to show the decrease in size</span>


<span class="k">def</span> <span class="nf">count_points</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_count</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">hole</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="k">for</span> <span class="n">hole</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">interiors</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">_count</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_count</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>


<span class="c1"># Count the total number of nodes in the shapes:</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Total number of nodes in the raw shapes : &quot;</span><span class="p">,</span>
    <span class="n">shapes</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">count_points</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
<span class="p">)</span>

<span class="n">min_grid_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
    <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ds_in</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s2">&quot;lat&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ds_in</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s2">&quot;lon&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Minimal grid size [°] of input ds: </span><span class="si">{</span><span class="n">min_grid_size</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, we will simplify to a tolerance of </span><span class="si">{</span><span class="n">min_grid_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">0.5f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>

<span class="c1"># Simplify geometries</span>
<span class="n">shapes_simp</span> <span class="o">=</span> <span class="n">shapes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">shapes_simp</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shapes</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">min_grid_size</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Total number of nodes in the simplified shapes : &quot;</span><span class="p">,</span>
    <span class="n">shapes_simp</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">count_points</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">shapes_simp</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">is_valid</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total number of nodes in the raw shapes :  166813
Minimal grid size [°] of input ds: 0.083, we will simplify to a tolerance of 0.00083
Total number of nodes in the simplified shapes :  7237
</pre></div>
</div>
</div>
</div>
</section>
<section id="averaging-over-each-polygon">
<h3>Averaging over each polygon<a class="headerlink" href="#averaging-over-each-polygon" title="Permalink to this heading">#</a></h3>
<p>Performing the spatial average is as simple as regridding. We first construct a <code class="docutils literal notranslate"><span class="pre">SpatialAverager</span></code> object from the input grid and polygons, then call it with the data to average. Note that xESMf expects a list of shapes, so we pass the <code class="docutils literal notranslate"><span class="pre">shapes.geometry</span></code> series (and not the <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> itself).</p>
<p>The returned DataArray was averaged along its spatial (lat/lon) dimensions and the average over the different shapes are along the new <code class="docutils literal notranslate"><span class="pre">geom</span></code> dimension, which is in the same order as the initial GeoDataframe.</p>
<p>The current missing value handling in xESMF’s SpatialAverager is very strict and we can see here how the 3 MRCs that overlap with ocean cells of the data (where tasmin is NaN) are flagged as missing (NaN).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>
<span class="n">savg</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">SpatialAverager</span><span class="p">(</span><span class="n">ds_in</span><span class="p">,</span> <span class="n">shapes_simp</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
<span class="n">tn_avg</span> <span class="o">=</span> <span class="n">savg</span><span class="p">(</span><span class="n">ds_in</span><span class="o">.</span><span class="n">tasmin</span><span class="p">)</span>
<span class="n">tn_avg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (geom: 10)&gt;
array([      nan,       nan, 274.64337, 275.4841 ,       nan, 276.23578,
       274.05746, 276.86087, 275.4918 , 276.8586 ], dtype=float32)
Coordinates:
    lon      (geom) float64 -66.01 -63.91 -77.09 -76.16 ... -73.26 -76.76 -73.98
    lat      (geom) float64 49.21 48.29 46.43 46.91 ... 47.13 48.81 48.15 48.04
Dimensions without coordinates: geom
Attributes:
    regrid_method:  conservative</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span>geom</span>: 10</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-ac6cac7b-6b74-4c7d-b440-cea73e48af78' class='xr-array-in' type='checkbox' checked><label for='section-ac6cac7b-6b74-4c7d-b440-cea73e48af78' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>nan nan 274.6 275.5 nan 276.2 274.1 276.9 275.5 276.9</span></div><div class='xr-array-data'><pre>array([      nan,       nan, 274.64337, 275.4841 ,       nan, 276.23578,
       274.05746, 276.86087, 275.4918 , 276.8586 ], dtype=float32)</pre></div></div></li><li class='xr-section-item'><input id='section-57ff5411-7d36-40a3-8bf0-d5277d501f4f' class='xr-section-summary-in' type='checkbox'  checked><label for='section-57ff5411-7d36-40a3-8bf0-d5277d501f4f' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>lon</span></div><div class='xr-var-dims'>(geom)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-66.01 -63.91 ... -76.76 -73.98</div><input id='attrs-bac31006-1030-49cb-9b2b-aca867ec065f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-bac31006-1030-49cb-9b2b-aca867ec065f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-65e76d9f-846b-414a-8327-e2e896f39b04' class='xr-var-data-in' type='checkbox'><label for='data-65e76d9f-846b-414a-8327-e2e896f39b04' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-66.00866787, -63.90580973, -77.09387447, -76.16114822,
       -69.47893016, -75.18601963, -78.56047535, -73.25902649,
       -76.75643137, -73.97936042])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>lat</span></div><div class='xr-var-dims'>(geom)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>49.21 48.29 46.43 ... 48.15 48.04</div><input id='attrs-508f8539-4932-4218-9a17-da60e7b45f79' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-508f8539-4932-4218-9a17-da60e7b45f79' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0966d0dd-8f0e-49d4-b438-7a9bc721edca' class='xr-var-data-in' type='checkbox'><label for='data-0966d0dd-8f0e-49d4-b438-7a9bc721edca' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([49.21407442, 48.28708548, 46.4260869 , 46.90616996, 48.99808939,
       46.89698131, 47.12947088, 48.81139074, 48.15154836, 48.04411744])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-4ca0d888-14c9-42d0-8392-5ed6de65fdf5' class='xr-section-summary-in' type='checkbox'  checked><label for='section-4ca0d888-14c9-42d0-8392-5ed6de65fdf5' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>regrid_method :</span></dt><dd>conservative</dd></dl></div></li></ul></div></div></div></div>
</div>
</section>
<section id="merging-polygon-features-properties-into-the-result">
<h3>Merging polygon features’ properties into the result<a class="headerlink" href="#merging-polygon-features-properties-into-the-result" title="Permalink to this heading">#</a></h3>
<p>In the previous results, the polygons are indexed along the <code class="docutils literal notranslate"><span class="pre">geom</span></code> dimension, but we’d like to have the region names and properties.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>

<span class="c1"># Set coordinates of &quot;geom&quot; to the shapes index</span>
<span class="n">tn_avg</span><span class="p">[</span><span class="s2">&quot;geom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shapes_simp</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Get a Dataset of properties from the dataframe</span>
<span class="c1"># Drop the geometries (we don&#39;t want them), convert to xarray and rename the index so it matches the one in tn_avg</span>
<span class="n">props</span> <span class="o">=</span> <span class="n">shapes_simp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">MRS_NM_MRC</span><span class="o">=</span><span class="s2">&quot;geom&quot;</span><span class="p">)</span>

<span class="c1"># Assign all properties as &quot;auxiliary&quot; coordinates</span>
<span class="n">tn_avg</span> <span class="o">=</span> <span class="n">tn_avg</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="o">**</span><span class="n">props</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span>
<span class="n">tn_avg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (geom: 10)&gt;
array([      nan,       nan, 274.64337, 275.4841 ,       nan, 276.23578,
       274.05746, 276.86087, 275.4918 , 276.8586 ], dtype=float32)
Coordinates:
    lon      (geom) float64 -66.01 -63.91 -77.09 -76.16 ... -73.26 -76.76 -73.98
    lat      (geom) float64 49.21 48.29 46.43 46.91 ... 47.13 48.81 48.15 48.04
  * geom     (geom) object &#x27;La Haute-Gaspésie&#x27; &#x27;Le Rocher-Percé&#x27; ... &#x27;La Tuque&#x27;
    AREA     (geom) float64 1.415 1.543 1.654 1.673 ... 2.283 2.364 3.307 3.573
Attributes:
    regrid_method:  conservative</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>geom</span>: 10</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-0fe4dc84-f871-4b9d-b1ed-4f21d8034fda' class='xr-array-in' type='checkbox' checked><label for='section-0fe4dc84-f871-4b9d-b1ed-4f21d8034fda' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>nan nan 274.6 275.5 nan 276.2 274.1 276.9 275.5 276.9</span></div><div class='xr-array-data'><pre>array([      nan,       nan, 274.64337, 275.4841 ,       nan, 276.23578,
       274.05746, 276.86087, 275.4918 , 276.8586 ], dtype=float32)</pre></div></div></li><li class='xr-section-item'><input id='section-30d3296c-2003-40a8-8a57-a2a27b364d54' class='xr-section-summary-in' type='checkbox'  checked><label for='section-30d3296c-2003-40a8-8a57-a2a27b364d54' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>lon</span></div><div class='xr-var-dims'>(geom)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-66.01 -63.91 ... -76.76 -73.98</div><input id='attrs-6380d7a3-3c29-40dc-bf70-139661a5190a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6380d7a3-3c29-40dc-bf70-139661a5190a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2f21d2e6-5f1b-4be5-ab96-f20c2b845cc1' class='xr-var-data-in' type='checkbox'><label for='data-2f21d2e6-5f1b-4be5-ab96-f20c2b845cc1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-66.00866787, -63.90580973, -77.09387447, -76.16114822,
       -69.47893016, -75.18601963, -78.56047535, -73.25902649,
       -76.75643137, -73.97936042])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>lat</span></div><div class='xr-var-dims'>(geom)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>49.21 48.29 46.43 ... 48.15 48.04</div><input id='attrs-a3b76682-e5d0-4996-b313-03740fb29aee' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a3b76682-e5d0-4996-b313-03740fb29aee' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-56c1c2f7-a7d0-470d-8edf-97c328083565' class='xr-var-data-in' type='checkbox'><label for='data-56c1c2f7-a7d0-470d-8edf-97c328083565' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([49.21407442, 48.28708548, 46.4260869 , 46.90616996, 48.99808939,
       46.89698131, 47.12947088, 48.81139074, 48.15154836, 48.04411744])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>geom</span></div><div class='xr-var-dims'>(geom)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;La Haute-Gaspésie&#x27; ... &#x27;La Tuque&#x27;</div><input id='attrs-513316d2-5a3c-4197-8c5e-445a504f328b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-513316d2-5a3c-4197-8c5e-445a504f328b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0cb642ea-af4b-469c-8bba-d52dae78fc97' class='xr-var-data-in' type='checkbox'><label for='data-0cb642ea-af4b-469c-8bba-d52dae78fc97' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;La Haute-Gaspésie&#x27;, &#x27;Le Rocher-Percé&#x27;, &#x27;Pontiac&#x27;,
       &#x27;La Vallée-de-la-Gatineau&#x27;, &#x27;La Haute-Côte-Nord&#x27;, &#x27;Antoine-Labelle&#x27;,
       &#x27;Témiscamingue&#x27;, &#x27;Le Domaine-du-Roy&#x27;, &quot;La Vallée-de-l&#x27;Or&quot;, &#x27;La Tuque&#x27;],
      dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>AREA</span></div><div class='xr-var-dims'>(geom)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.415 1.543 1.654 ... 3.307 3.573</div><input id='attrs-9bc9403e-2aed-4428-abf6-7196acbe3890' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9bc9403e-2aed-4428-abf6-7196acbe3890' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-403c44c3-cbba-49bc-a83d-bc1caad38e10' class='xr-var-data-in' type='checkbox'><label for='data-403c44c3-cbba-49bc-a83d-bc1caad38e10' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1.41460387, 1.54254676, 1.65378905, 1.67264012, 1.80053007,
       1.92389157, 2.28258236, 2.3637143 , 3.30665646, 3.57283842])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-9f5dff3f-6e52-4444-acaf-8ec484059ea9' class='xr-section-summary-in' type='checkbox'  checked><label for='section-9f5dff3f-6e52-4444-acaf-8ec484059ea9' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>regrid_method :</span></dt><dd>conservative</dd></dl></div></li></ul></div></div></div></div>
</div>
<p>Or, on the contrary, we could want to merge the averaged data to the dataframe instead.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>
<span class="n">shapes_data</span> <span class="o">=</span> <span class="n">shapes_simp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">shapes_data</span><span class="p">[</span><span class="s2">&quot;tasmin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tn_avg</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span>
<span class="n">shapes_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
      <th>AREA</th>
      <th>tasmin</th>
    </tr>
    <tr>
      <th>MRS_NM_MRC</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>La Haute-Gaspésie</th>
      <td>POLYGON ((-65.19300 49.18900, -65.18720 49.099...</td>
      <td>1.414604</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Le Rocher-Percé</th>
      <td>POLYGON ((-62.99910 48.62500, -62.99910 47.157...</td>
      <td>1.542547</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Pontiac</th>
      <td>POLYGON ((-77.91790 47.26940, -77.64730 47.269...</td>
      <td>1.653789</td>
      <td>274.643372</td>
    </tr>
    <tr>
      <th>La Vallée-de-la-Gatineau</th>
      <td>POLYGON ((-76.27030 47.68990, -76.27000 47.692...</td>
      <td>1.672640</td>
      <td>275.484100</td>
    </tr>
    <tr>
      <th>La Haute-Côte-Nord</th>
      <td>POLYGON ((-69.50820 49.99830, -69.51050 49.997...</td>
      <td>1.800530</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Antoine-Labelle</th>
      <td>POLYGON ((-75.04050 47.76270, -74.88940 47.762...</td>
      <td>1.923892</td>
      <td>276.235779</td>
    </tr>
    <tr>
      <th>Témiscamingue</th>
      <td>MULTIPOLYGON (((-77.57920 47.44240, -77.58630 ...</td>
      <td>2.282582</td>
      <td>274.057465</td>
    </tr>
    <tr>
      <th>Le Domaine-du-Roy</th>
      <td>POLYGON ((-73.68260 49.99730, -73.68440 49.997...</td>
      <td>2.363714</td>
      <td>276.860870</td>
    </tr>
    <tr>
      <th>La Vallée-de-l'Or</th>
      <td>MULTIPOLYGON (((-77.57920 47.44240, -77.57290 ...</td>
      <td>3.306656</td>
      <td>275.491791</td>
    </tr>
    <tr>
      <th>La Tuque</th>
      <td>POLYGON ((-74.67630 48.99960, -74.62850 48.967...</td>
      <td>3.572838</td>
      <td>276.858612</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now we can plot easily the results as a choropleth map!</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">shapes_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="s2">&quot;tasmin&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Minimal temperature 1993-05-20 [K]&quot;</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3ccfa7dc8bea6e5a9176e7cb38a82f8c496d4d36fbe6fd74eeb9d88fcfaf01d9.png" src="../_images/3ccfa7dc8bea6e5a9176e7cb38a82f8c496d4d36fbe6fd74eeb9d88fcfaf01d9.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./pavics-sdi"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="pavics_thredds.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Accessing PAVICS THREDDS Server</p>
      </div>
    </a>
    <a class="right-next"
       href="rendering.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Gridded Data Renderer</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-example-bilinear-regridding-from-model-to-obs">Simple example : Bilinear regridding from model to obs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-input-data">The input data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-output-grid">The output grid</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regridding-input-data-unto-the-output-grid">Regridding input data unto the output grid</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#second-example-conservative-regridding-and-reusing-weights">Second example : Conservative regridding and reusing weights</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#untangling-corners-definitions">Untangling corners definitions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-the-corners">Computing the corners</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regridding">Regridding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reusing-weights">Reusing weights</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#third-example-regridding-and-masks">Third example : Regridding and masks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#target-grid-and-mask">Target grid and mask</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#default-regridding-no-mask-handling">Default regridding - No mask handling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#normalization-for-conservative-regridding">Normalization for conservative regridding</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fourth-example-averaging-over-polygons">Fourth example : Averaging over polygons</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-polygon-shapes">Define polygon shapes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validate-and-simplify-shapes">Validate and simplify shapes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#averaging-over-each-polygon">Averaging over each polygon</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-polygon-features-properties-into-the-result">Merging polygon features’ properties into the result</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>